

### Django开发流程

**1. 安装Django**

python2

```shell
$ pip install django
```

python3

```shell
$ pip3 install django
```

如果需要使用pip3更新pip，可以通过指定源的方式来更新

```shell
$ sudo pip3 install -i https://mirrors.aliyun.com/pypi/simple/ pip==18.1
```

通过指定源的方式可以临时调用其它源来安装工具包！

pip3更新后可能会遇到from pip import main ImportError: cannot import name 'main'的报错

解决方法：修改/usr/bin/pip3内容

修改前：

```gedit
#!/usr/bin/python3
# GENERATED BY DEBIAN

import sys

# Run the main entry point, similarly to how setuptools does it, but because
# we didn't install the actual entry point from setup.py, don't use the
# pkg_resources API.
from pip import main
if __name__ == '__main__':
    sys.exit(main())
```

修改后为：

```gedit
#!/usr/bin/python3
# GENERATED BY DEBIAN

import sys

# Run the main entry point, similarly to how setuptools does it, but because
# we didn't install the actual entry point from setup.py, don't use the
# pkg_resources API.
from pip import __main__
if __name__ == '__main__':
    sys.exit(__main__._main())
```

**2.创建项目**

```shell
$ django-admin.py startproject learn
# 或者
$ django-admin startproject learn
```

会在当前目录下生成文件夹learn(learn文件夹下包含一个learn文件夹和manage.py文件)

django-admin.py在django安装成功后在任意路径下都可以调用

**3. 创建应用程序**(应用程序非必须)

进入到learn文件夹

```
$ python3 manage.py startapp learnapp
```

会在当前目录下创建文件夹learnapp

```
$ cd learnapp
$ ls -a
```

.   admin.py  __init__.py  models.py  views.py
..  apps.py   migrations   tests.py

**4. 添加应用程序**

将learnapp添加到learn/learn/settings.py中，如下：

```python
# Application definition
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'learnapp'  #添加这个
]
```

这里没改动models.py文件，假如有改动了需要同步得执行如下两个命令来同步(都先添加了应用到setting.py后才能执行此命令)

python manage.py  makemigrations

python manage.py migrate

修改了models.py后需要执行上面两条指令

**5. 启动服务器**

```shell
$ python3 manage.py runserver
```

通过python manage.py runserver成功启动服务器后，你在ubuntu上用浏览器打开

localhost:8000/admin就会看到一个登陆页面了。

**6.局域网访问**

编辑setting.py文件

ALLOWED_HOSTS = ['192.168.253.135']

填你django所在的服务器ip。

runserver不加参数默认只能本地访问。如果这样启动

python manage.py runserver 0.0.0.0:8000

0.0.0.0:8000 表示让Django监听所有网络接口和IP地址，否则默认监听127.0.0.1:8000，也就是只允许本机访问。

你在其他任何能访问这个ip的地方输入如下url就能访问了

http://192.168.253.135:8000/admin

**7. 进阶操作**

1) django-admin.py与manage.py

创建项目时用到了django-admin.py，它是Django的任务管理命令行工具。它的命令行参数如下：

```shell
check
compilemessages
createcachetable
dbshell
diffsettings
dumpdata
flush
inspectdb
loaddata
makemessages
makemigrations
migrate
runserver
sendtestemail
shell
showmigrations
sqlflush
sqlmigrate
sqlsequencereset
squashmigrations
startapp
startproject
test
testserver
```

可通过`$ django-admin`显示与

可通过`$ django-admin help 命令行参数`查看每个参数的含义和作用。

其实查看参数功能会发现django-admin.py和manage.py功能大体相同，只有少数特殊的，但前者在安装是就添加到系统bin文件下了，所以全局执行。而manage.py是针对一个项目的，它在项目存在后才会生成。对于单个项目，还是建议使用manage.py比较好，不会出错。

2) learn下的learn，这个learn是所建项目的管理功能目录。其中包括：

* setting.py: 包括了项目的初始化设置，可以针对整个项目进行有关参数配置，比如配置数据库、添加应用。
* urls.py: url配置表文件，用于将url映射到应用程序上
* wsgi.py: WSGI是Web server Gateway Interface的缩写，python的web服务器应用标准

* \_\_pycache\_\_:如果创建项目后，不执行python manage.py runserver，没有在浏览器上查看网站是否运行，那么它是不存在的。

3) learnapp，项目创建的应用程序。创建一个应用程序时会生成一些默认的文件：

* admin.py: 在这个文件中，可以自定义Django管理工具。
* apps.py: 对应用的配置
* migrations: 一个目录，用于存储应用的数据库表结构的指令，通过这些指令修改创建数据库，从而在models.py模型类和数据库表之间迁移。
* models.py: 应用的数据模型文件，可以为空，但不要删除。
* test.py: 测试文档用于测试。
* views.py: 保存响应各种请求的函数或类的视图文件。

4) db.sqlite3，默认的数据库。SQLite是python默认安装的数据库，django中默认使用！

**8. MVC模式**

* M:数据存储和读取部分， 由Django的数据模型部分承担
* V: 确定显示哪些数据及如何显示，由视图和模板进行处理
* C: 根据客户端请求映射到相应的视图，由Django框架根据URLconf设置，调用相应的函数。

MVC是动态网站普遍遵循的模式，在Django中，Controller部分事实上是由框架自动处理的，所以Django就变成了MTV(Model, Template, Views)模式了。